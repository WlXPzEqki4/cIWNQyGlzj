<!-- <!DOCTYPE html>
<html>
<head>
    <title>Data Visualization Map</title>
    <script src="https://unpkg.com/deck.gl@latest/dist.min.js"></script>
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.css" rel="stylesheet"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

    <style>
        body { 
            margin: 0; 
            padding: 0; 
        }
        #map { 
            position: absolute; 
            top: 0; 
            bottom: 0; 
            width: 100%; 
        }

        .control-panel {
            position: absolute;
            top: 0;
            right: 0;
            width: 300px;
            background: white;
            margin: 20px;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }
    
        .control-panel h3 {
            color: #262730;
            font-size: 18px;
            margin: 0 0 20px 0;
            font-weight: 600;
        }
    
        .control-panel .layer-option {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
    
        .control-panel .layer-option label {
            display: flex;
            align-items: center;
            color: #262730;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }
    
        .control-panel input[type="checkbox"] {
            margin-right: 10px;
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
    
        .control-panel .slider-container {
            margin: 20px 0;
        }
    
        .control-panel .slider-label {
            display: block;
            color: #262730;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
        }
    
        .control-panel input[type="range"] {
            width: 100%;
            margin: 8px 0;
        }
    
        /* Add a subtle border between sections */
        .control-panel .section-divider {
            border-top: 1px solid #f0f0f0;
            margin: 15px 0;
        }
    </style>

    
</head>
<body>
    <div id="map"></div>
    <div class="control-panel">
        <h3>Layer Controls</h3>
        
        <div class="layer-option">
            <label>
                <input type="checkbox" id="scatter" checked>
                Scatterplot
            </label>
        </div>
        
        <div class="layer-option">
            <label>
                <input type="checkbox" id="heatmap">
                Heatmap
            </label>
        </div>
        
        <div class="layer-option">
            <label>
                <input type="checkbox" id="hexagon">
                Hexagon
            </label>
        </div>
    
        <div class="section-divider"></div>

        <div class="slider-container">
            <span class="slider-label">Point Size</span>
            <input type="range" id="point-radius" min="1" max="50" value="10">
        </div>

        <div class="slider-container">
            <span class="slider-label">Hexagon Radius</span>
            <input type="range" id="radius" min="10" max="200" value="50">
        </div>

        <div class="slider-container">
            <span class="slider-label">Hexagon Height Scale</span>
            <input type="range" id="elevation" min="1" max="20" value="5">
        </div>

    </div>

    <script type="text/javascript">
        const MAPBOX_TOKEN = 'pk.eyJ1IjoiamNkZW50b24yMDUxIiwiYSI6ImNtMzVkZXJudTA5ejkya3B5NDU4Z2MyeHQifQ.aUk4eH5k3JC45Foxcbe2qQ';
        const {DeckGL, ScatterplotLayer, HeatmapLayer, HexagonLayer} = deck;

        async function initializeMap() {
            try {
                // Load CSV data
                const response = await fetch('/assets/df.csv');
                const csvText = await response.text();
                const results = Papa.parse(csvText, {
                    header: true,
                    dynamicTyping: true
                });

                const data = results.data.filter(row => row.latitude && row.longitude);

                // Calculate center point with fallback
                const center = data.length > 0 ? 
                    data.reduce((acc, row) => ({
                        latitude: acc.latitude + row.latitude / data.length,
                        longitude: acc.longitude + row.longitude / data.length
                    }), { latitude: 0, longitude: 0 }) : 
                    { latitude: 24.467, longitude: 54.608 }; // Yas Links coordinates as fallback


                function getLayers() {
                    const layers = [];
                    const hexRadius = document.getElementById('radius').value;
                    const elevation = document.getElementById('elevation').value;
                    const pointRadius = document.getElementById('point-radius').value;

    if (document.getElementById('scatter').checked) {
        layers.push(new ScatterplotLayer({
            id: 'scatter',
            data,
            getPosition: d => [d.longitude, d.latitude],
            getFillColor: [255, 0, 0, 140],
            getRadius: parseInt(pointRadius), // Use the new point size slider
            pickable: true
        }));
    }

    if (document.getElementById('heatmap').checked) {
        layers.push(new HeatmapLayer({
            id: 'heat',
            data,
            getPosition: d => [d.longitude, d.latitude],
            getWeight: 1,
            radiusPixels: 60,
            intensity: 1
        }));
    }

    if (document.getElementById('hexagon').checked) {
        layers.push(new HexagonLayer({
            id: 'hex',
            data,
            getPosition: d => [d.longitude, d.latitude],
            radius: parseInt(hexRadius),
            elevationScale: parseInt(elevation),
            extruded: true,
            colorRange: [
                [245, 240, 200], // Light beige/yellow for low density
                [230, 220, 160],
                [230, 179, 95],  // Medium yellow/orange
                [227, 139, 79],  // Orange
                [215, 95, 78],   // Orange-red
                [200, 43, 66]    // Deep red for high density
            ],
            coverage: 0.8,
            upperPercentile: 100,
            getElevationWeight: d => 1,
            getColorWeight: d => 1,
            pickable: true,
            autoHighlight: true,
            material: {
                ambient: 0.64,
                diffuse: 0.6,
                shininess: 32,
                specularColor: [51, 51, 51]
            }
        }));
    }
    return layers;
}
                // Initialize deck.gl with Mapbox
                deckgl = new DeckGL({
                    container: 'map',
                    mapStyle: 'mapbox://styles/mapbox/dark-v10',
                    mapboxApiAccessToken: MAPBOX_TOKEN,
                    initialViewState: {
                        longitude: center.longitude,
                        latitude: center.latitude,
                        zoom: 13,
                        pitch: 45,
                        bearing: 0
                    },
                    controller: true,
                    layers: getLayers()
                });

                // Update the event listeners section
                document.querySelectorAll('input').forEach(input => {
                    input.addEventListener('input', () => { // Changed from 'change' to 'input'
                        deckgl.setProps({layers: getLayers()});
                    });
                });

            } catch (error) {
                console.error('Error loading or processing data:', error);
            }
        }

        initializeMap();
    </script>
</body>
</html> -->



<!-- 
<!DOCTYPE html>
<html>
   <head>
      <title>Data Visualization Map</title>
      <script src="https://unpkg.com/deck.gl@latest/dist.min.js"></script>
      <script src="https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.js"></script>
      <link href="https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.css" rel="stylesheet"/>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
      <style>
         body { 
         margin: 0; 
         padding: 0; 
         }
         #map { 
         position: absolute; 
         top: 0; 
         bottom: 0; 
         width: 100%; 
         }
         .control-panel {
         position: absolute;
         top: 0;
         right: 0;
         width: 300px;
         background: white;
         margin: 20px;
         padding: 20px;
         border-radius: 8px;
         box-shadow: 0 2px 10px rgba(0,0,0,0.1);
         font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
         }
         .control-panel h3 {
         color: #262730;
         font-size: 18px;
         margin: 0 0 20px 0;
         font-weight: 600;
         }
         .control-panel .layer-option {
         display: flex;
         align-items: center;
         margin-bottom: 15px;
         }
         .control-panel .layer-option label {
         display: flex;
         align-items: center;
         color: #262730;
         font-size: 14px;
         font-weight: 500;
         cursor: pointer;
         }
         .control-panel input[type="checkbox"] {
         margin-right: 10px;
         width: 16px;
         height: 16px;
         cursor: pointer;
         }
         .control-panel .slider-container {
         margin: 20px 0;
         }
         .control-panel .slider-label {
         display: block;
         color: #262730;
         font-size: 14px;
         font-weight: 500;
         margin-bottom: 8px;
         }
         .control-panel input[type="range"] {
         width: 100%;
         margin: 8px 0;
         }
         /* Add a subtle border between sections */
         .control-panel .section-divider {
         border-top: 1px solid #f0f0f0;
         margin: 15px 0;
         }
      </style>
   </head>
   <body>
      <div id="map"></div>
      <div class="control-panel">
         <h3>Layer Controls</h3>
         <div class="layer-option">
            <label>
            <input type="checkbox" id="scatter" checked>
            Scatterplot
            </label>
         </div>
         <div class="layer-option">
            <label>
            <input type="checkbox" id="heatmap">
            Heatmap
            </label>
         </div>
         <div class="layer-option">
            <label>
            <input type="checkbox" id="hexagon">
            Hexagon
            </label>
         </div>
         <div class="section-divider"></div>
         <div class="slider-container">
            <span class="slider-label">Point Size</span>
            <input type="range" id="point-radius" min="1" max="50" value="10">
         </div>
         <div class="slider-container">
            <span class="slider-label">Hexagon Radius</span>
            <input type="range" id="radius" min="10" max="200" value="50">
         </div>
         <div class="slider-container">
            <span class="slider-label">Hexagon Height Scale</span>
            <input type="range" id="elevation" min="1" max="20" value="5">
         </div>
      </div>
      <script type="text/javascript">
         const MAPBOX_TOKEN = 'pk.eyJ1IjoiamNkZW50b24yMDUxIiwiYSI6ImNtMzVkZXJudTA5ejkya3B5NDU4Z2MyeHQifQ.aUk4eH5k3JC45Foxcbe2qQ';
         const {DeckGL, ScatterplotLayer, HeatmapLayer, HexagonLayer} = deck;
         
         async function initializeMap() {
             try {
                 // Load CSV data
                 const response = await fetch('/assets/df.csv');
                 const csvText = await response.text();
                 const results = Papa.parse(csvText, {
                     header: true,
                     dynamicTyping: true
                 });
         
                 const data = results.data.filter(row => row.latitude && row.longitude);
         
                 // Calculate center point with fallback
                 const center = data.length > 0 ? 
                     data.reduce((acc, row) => ({
                         latitude: acc.latitude + row.latitude / data.length,
                         longitude: acc.longitude + row.longitude / data.length
                     }), { latitude: 0, longitude: 0 }) : 
                     { latitude: 24.467, longitude: 54.608 }; // Yas Links coordinates as fallback
         
         
                 function getLayers() {
                     const layers = [];
                     const hexRadius = document.getElementById('radius').value;
                     const elevation = document.getElementById('elevation').value;
                     const pointRadius = document.getElementById('point-radius').value;
         
         if (document.getElementById('scatter').checked) {
         layers.push(new ScatterplotLayer({
             id: 'scatter',
             data,
             getPosition: d => [d.longitude, d.latitude],
             getFillColor: [255, 0, 0, 140],
             getRadius: parseInt(pointRadius), // Use the new point size slider
             pickable: true
         }));
         }
         
         if (document.getElementById('heatmap').checked) {
         layers.push(new HeatmapLayer({
             id: 'heat',
             data,
             getPosition: d => [d.longitude, d.latitude],
             getWeight: 1,
             radiusPixels: 60,
             intensity: 1
         }));
         }
         
         if (document.getElementById('hexagon').checked) {
         layers.push(new HexagonLayer({
             id: 'hex',
             data,
             getPosition: d => [d.longitude, d.latitude],
             radius: parseInt(hexRadius),
             elevationScale: parseInt(elevation),
             extruded: true,
             colorRange: [
                 [245, 240, 200], // Light beige/yellow for low density
                 [230, 220, 160],
                 [230, 179, 95],  // Medium yellow/orange
                 [227, 139, 79],  // Orange
                 [215, 95, 78],   // Orange-red
                 [200, 43, 66]    // Deep red for high density
             ],
             coverage: 0.8,
             upperPercentile: 100,
             getElevationWeight: d => 1,
             getColorWeight: d => 1,
             pickable: true,
             autoHighlight: true,
             material: {
                 ambient: 0.64,
                 diffuse: 0.6,
                 shininess: 32,
                 specularColor: [51, 51, 51]
             }
         }));
         }
         return layers;
         }
                 // Initialize deck.gl with Mapbox
                 deckgl = new DeckGL({
                     container: 'map',
                     mapStyle: 'mapbox://styles/mapbox/dark-v10',
                     mapboxApiAccessToken: MAPBOX_TOKEN,
                     initialViewState: {
                         longitude: center.longitude,
                         latitude: center.latitude,
                         zoom: 13,
                         pitch: 45,
                         bearing: 0
                     },
                     controller: true,
                     layers: getLayers()
                 });
         
                 // Update the event listeners section
                 document.querySelectorAll('input').forEach(input => {
                     input.addEventListener('input', () => { // Changed from 'change' to 'input'
                         deckgl.setProps({layers: getLayers()});
                     });
                 });
         
             } catch (error) {
                 console.error('Error loading or processing data:', error);
             }
         }
         
         initializeMap();
      </script>
   </body>
</html>

 -->















<!-- 

<!DOCTYPE html>
<html>
<head>
    <title>Data Visualization Map</title>
    <script src="https://unpkg.com/deck.gl@latest/dist.min.js"></script>
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.css" rel="stylesheet"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

    <style>
        body { 
            margin: 0; 
            padding: 0; 
        }
        #map { 
            position: absolute; 
            top: 0; 
            bottom: 0; 
            width: 100%; 
        }

        .control-panel {
            position: absolute;
            top: 0;
            left: 0;
            width: 300px;
            background: white;
            margin: 20px;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            z-index: 1;
        }
    
        .control-panel h3 {
            color: #262730;
            font-size: 18px;
            margin: 0 0 20px 0;
            font-weight: 600;
        }
    
        .control-panel .layer-option {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
    
        .control-panel .layer-option label {
            display: flex;
            align-items: center;
            color: #262730;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }
    
        .control-panel input[type="checkbox"] {
            margin-right: 10px;
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
    
        .control-panel .slider-container {
            margin: 20px 0;
        }
    
        .control-panel .slider-label {
            display: block;
            color: #262730;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
        }
    
        .control-panel input[type="range"] {
            width: 100%;
            margin: 8px 0;
        }
    
        .control-panel .section-divider {
            border-top: 1px solid #f0f0f0;
            margin: 15px 0;
        }

        .control-panel .style-select {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
            font-size: 14px;
        }

        .control-panel .style-select:focus {
            outline: none;
            border-color: #4299e1;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div class="control-panel">
        <h3>Layer Controls</h3>

        <div class="layer-option">
            <span class="slider-label">Map Style</span>
            <select id="map-style" class="style-select">
                <option value="mapbox://styles/mapbox/dark-v10">Dark</option>
                <option value="mapbox://styles/mapbox/light-v10">Light</option>
                <option value="mapbox://styles/mapbox/satellite-v9">Satellite</option>
                <option value="mapbox://styles/mapbox/streets-v11">Streets</option>
                <option value="mapbox://styles/mapbox/outdoors-v11">Outdoors</option>
            </select>
        </div>

        <div class="section-divider"></div>
        
        <div class="layer-option">
            <label>
                <input type="checkbox" id="scatter" checked>
                Scatterplot
            </label>
        </div>
        
        <div class="layer-option">
            <label>
                <input type="checkbox" id="heatmap">
                Heatmap
            </label>
        </div>
        
        <div class="layer-option">
            <label>
                <input type="checkbox" id="hexagon">
                Hexagon
            </label>
        </div>
    
        <div class="section-divider"></div>

        <div class="slider-container">
            <span class="slider-label">Point Size</span>
            <input type="range" id="point-radius" min="1" max="50" value="10">
        </div>

        <div class="slider-container">
            <span class="slider-label">Hexagon Radius</span>
            <input type="range" id="radius" min="10" max="200" value="50">
        </div>

        <div class="slider-container">
            <span class="slider-label">Hexagon Height Scale</span>
            <input type="range" id="elevation" min="1" max="20" value="5">
        </div>
    </div>

    <script type="text/javascript">
        const MAPBOX_TOKEN = 'pk.eyJ1IjoiamNkZW50b24yMDUxIiwiYSI6ImNtMzVkZXJudTA5ejkya3B5NDU4Z2MyeHQifQ.aUk4eH5k3JC45Foxcbe2qQ';
        const {DeckGL, ScatterplotLayer, HeatmapLayer, HexagonLayer} = deck;

        async function initializeMap() {
            try {
                // Load CSV data
                const response = await fetch('/assets/df.csv');
                const csvText = await response.text();
                const results = Papa.parse(csvText, {
                    header: true,
                    dynamicTyping: true
                });

                const data = results.data.filter(row => row.latitude && row.longitude);

                // Calculate center point with fallback
                const center = data.length > 0 ? 
                    data.reduce((acc, row) => ({
                        latitude: acc.latitude + row.latitude / data.length,
                        longitude: acc.longitude + row.longitude / data.length
                    }), { latitude: 0, longitude: 0 }) : 
                    { latitude: 24.467, longitude: 54.608 }; // Yas Links coordinates as fallback

                function getLayers() {
                    const layers = [];
                    const hexRadius = document.getElementById('radius').value;
                    const elevation = document.getElementById('elevation').value;
                    const pointRadius = document.getElementById('point-radius').value;

                    if (document.getElementById('scatter').checked) {
                        layers.push(new ScatterplotLayer({
                            id: 'scatter',
                            data,
                            getPosition: d => [d.longitude, d.latitude],
                            getFillColor: [255, 0, 0, 140],
                            getRadius: parseInt(pointRadius),
                            pickable: true
                        }));
                    }

                    if (document.getElementById('heatmap').checked) {
                        layers.push(new HeatmapLayer({
                            id: 'heat',
                            data,
                            getPosition: d => [d.longitude, d.latitude],
                            getWeight: 1,
                            radiusPixels: 60,
                            intensity: 1
                        }));
                    }

                    if (document.getElementById('hexagon').checked) {
                        layers.push(new HexagonLayer({
                            id: 'hex',
                            data,
                            getPosition: d => [d.longitude, d.latitude],
                            radius: parseInt(hexRadius),
                            elevationScale: parseInt(elevation),
                            extruded: true,
                            colorRange: [
                                [245, 240, 200], // Light beige/yellow for low density
                                [230, 220, 160],
                                [230, 179, 95],  // Medium yellow/orange
                                [227, 139, 79],  // Orange
                                [215, 95, 78],   // Orange-red
                                [200, 43, 66]    // Deep red for high density
                            ],
                            coverage: 0.8,
                            upperPercentile: 100,
                            getElevationWeight: d => 1,
                            getColorWeight: d => 1,
                            pickable: true,
                            autoHighlight: true,
                            material: {
                                ambient: 0.64,
                                diffuse: 0.6,
                                shininess: 32,
                                specularColor: [51, 51, 51]
                            }
                        }));
                    }
                    return layers;
                }

                // Initialize deck.gl with Mapbox
                deckgl = new DeckGL({
                    container: 'map',
                    mapStyle: 'mapbox://styles/mapbox/dark-v10',
                    mapboxApiAccessToken: MAPBOX_TOKEN,
                    initialViewState: {
                        longitude: center.longitude,
                        latitude: center.latitude,
                        zoom: 13,
                        pitch: 45,
                        bearing: 0
                    },
                    controller: true,
                    layers: getLayers()
                });

                // Add event listeners for controls
                document.querySelectorAll('input').forEach(input => {
                    input.addEventListener('input', () => {
                        deckgl.setProps({layers: getLayers()});
                    });
                });

                // Add event listener for map style changes
                document.getElementById('map-style').addEventListener('change', (e) => {
                    deckgl.setProps({
                        mapStyle: e.target.value
                    });
                });

            } catch (error) {
                console.error('Error loading or processing data:', error);
            }
        }

        initializeMap();
    </script>
</body>
</html>
 -->

















<!DOCTYPE html>
<html>
<head>
    <title>Data Visualization Map</title>
    <script src="https://unpkg.com/deck.gl@latest/dist.min.js"></script>
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.css" rel="stylesheet"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

    <style>
        body { 
            margin: 0; 
            padding: 0; 
        }
        #map { 
            position: absolute; 
            top: 0; 
            bottom: 0; 
            width: 100%; 
        }

        .control-panel {
            position: absolute;
            top: 0;
            left: 0;
            width: 300px;
            background: white;
            margin: 20px;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            z-index: 1;
        }
    
        .control-panel h3 {
            color: #262730;
            font-size: 18px;
            margin: 0 0 20px 0;
            font-weight: 600;
        }
    
        .control-panel .layer-option {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
    
        .control-panel .layer-option label {
            display: flex;
            align-items: center;
            color: #262730;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }
    
        .control-panel input[type="checkbox"] {
            margin-right: 10px;
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
    
        .control-panel .slider-container {
            margin: 20px 0;
        }
    
        .control-panel .slider-label {
            display: block;
            color: #262730;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
        }
    
        .control-panel input[type="range"] {
            width: 100%;
            margin: 8px 0;
        }
    
        .control-panel .section-divider {
            border-top: 1px solid #f0f0f0;
            margin: 15px 0;
        }

        .control-panel .style-select {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
            font-size: 14px;
        }

        .control-panel .style-select:focus {
            outline: none;
            border-color: #4299e1;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div class="control-panel">
        <h3>Layer Controls</h3>

        <div class="layer-option">
            <span class="slider-label">Map Style</span>
            <select id="map-style" class="style-select">
                <option value="mapbox://styles/mapbox/dark-v10">Dark</option>
                <option value="mapbox://styles/mapbox/light-v10">Light</option>
                <option value="mapbox://styles/mapbox/satellite-v9">Satellite</option>
                <option value="mapbox://styles/mapbox/streets-v11">Streets</option>
                <option value="mapbox://styles/mapbox/outdoors-v11">Outdoors</option>
            </select>
        </div>

        <div class="section-divider"></div>
        
        <div class="layer-option">
            <label>
                <input type="checkbox" id="scatter" checked>
                Scatterplot
            </label>
        </div>
        
        <div class="layer-option">
            <label>
                <input type="checkbox" id="heatmap">
                Heatmap
            </label>
        </div>
        
        <div class="layer-option">
            <label>
                <input type="checkbox" id="hexagon">
                Hexagon
            </label>
        </div>

        <!-- <div class="layer-option">
            <label>
                <input type="checkbox" id="buildings">
                3D Buildings
            </label>
        </div> -->
    
        <div class="section-divider"></div>

        <div class="slider-container">
            <span class="slider-label">Point Size</span>
            <input type="range" id="point-radius" min="1" max="50" value="10">
        </div>

        <div class="slider-container">
            <span class="slider-label">Hexagon Radius</span>
            <input type="range" id="radius" min="10" max="200" value="50">
        </div>

        <div class="slider-container">
            <span class="slider-label">Hexagon Height Scale</span>
            <input type="range" id="elevation" min="1" max="20" value="5">
        </div>
    </div>

    <script type="text/javascript">
        const MAPBOX_TOKEN = 'pk.eyJ1IjoiamNkZW50b24yMDUxIiwiYSI6ImNtMzVkZXJudTA5ejkya3B5NDU4Z2MyeHQifQ.aUk4eH5k3JC45Foxcbe2qQ';
        const {DeckGL, ScatterplotLayer, HeatmapLayer, HexagonLayer} = deck;

        async function initializeMap() {
            try {
                // Load CSV data
                // const response = await fetch('/assets/df.csv');
                const response = await fetch('/assets/df2.csv');


                const csvText = await response.text();
                const results = Papa.parse(csvText, {
                    header: true,
                    dynamicTyping: true
                });

                const data = results.data.filter(row => row.latitude && row.longitude);

                // Calculate center point with fallback
                const center = data.length > 0 ? 
                    data.reduce((acc, row) => ({
                        latitude: acc.latitude + row.latitude / data.length,
                        longitude: acc.longitude + row.longitude / data.length
                    }), { latitude: 0, longitude: 0 }) : 
                    { latitude: 24.467, longitude: 54.608 }; // Yas Links coordinates as fallback

                function getLayers() {
                    const layers = [];
                    const hexRadius = document.getElementById('radius').value;
                    const elevation = document.getElementById('elevation').value;
                    const pointRadius = document.getElementById('point-radius').value;




                    // if (document.getElementById('buildings').checked) {
                    //     layers.push(
                    //         new deck.GeoJsonLayer({
                    //             id: '3d-buildings',
                    //             data: 'https://tiles.mapbox.com/v3/examples.map-i875mjb7/13/2342/3135.vector.pbf',
                    //             extruded: true,
                    //             wireframe: true,
                    //             getElevation: f => f.properties.height || 10,
                    //             getFillColor: [74, 80, 87, 200],
                    //             getLineColor: [255, 255, 255],
                    //             pickable: true
                    //         })
                    //     );
                    // }




                    if (document.getElementById('scatter').checked) {
                        layers.push(new ScatterplotLayer({
                            id: 'scatter',
                            data,
                            getPosition: d => [d.longitude, d.latitude],
                            getFillColor: [255, 0, 0, 140],
                            getRadius: parseInt(pointRadius),
                            pickable: true
                        }));
                    }

                    if (document.getElementById('heatmap').checked) {
                        layers.push(new HeatmapLayer({
                            id: 'heat',
                            data,
                            getPosition: d => [d.longitude, d.latitude],
                            getWeight: 1,
                            radiusPixels: 60,
                            intensity: 1
                        }));
                    }

                    if (document.getElementById('hexagon').checked) {
                        layers.push(new HexagonLayer({
                            id: 'hex',
                            data,
                            getPosition: d => [d.longitude, d.latitude],
                            radius: parseInt(hexRadius),
                            elevationScale: parseInt(elevation),
                            extruded: true,
                            colorRange: [
                                [245, 240, 200], // Light beige/yellow for low density
                                [230, 220, 160],
                                [230, 179, 95],  // Medium yellow/orange
                                [227, 139, 79],  // Orange
                                [215, 95, 78],   // Orange-red
                                [200, 43, 66]    // Deep red for high density
                            ],
                            coverage: 0.8,
                            upperPercentile: 100,
                            getElevationWeight: d => 1,
                            getColorWeight: d => 1,
                            pickable: true,
                            autoHighlight: true,
                            material: {
                                ambient: 0.64,
                                diffuse: 0.6,
                                shininess: 32,
                                specularColor: [51, 51, 51]
                            }
                        }));
                    }
                    return layers;
                }

                // Initialize deck.gl with Mapbox
                deckgl = new DeckGL({
                    container: 'map',
                    mapStyle: 'mapbox://styles/mapbox/dark-v10',
                    mapboxApiAccessToken: MAPBOX_TOKEN,
                    initialViewState: {
                        longitude: center.longitude,
                        latitude: center.latitude,
                        zoom: 13,
                        pitch: 45,
                        bearing: 0
                    },
                    controller: true,
                    layers: getLayers()
                });

                // Add event listeners for controls
                document.querySelectorAll('input').forEach(input => {
                    input.addEventListener('input', () => {
                        deckgl.setProps({layers: getLayers()});
                    });
                });

                // Add event listener for map style changes
                document.getElementById('map-style').addEventListener('change', (e) => {
                    deckgl.setProps({
                        mapStyle: e.target.value
                    });
                });

            } catch (error) {
                console.error('Error loading or processing data:', error);
            }
        }

        initializeMap();
    </script>
</body>
</html>




















<!-- 
 


 <!DOCTYPE html>
 <html>
 <head>
     <title>Data Visualization Map</title>
     <script src="https://unpkg.com/@deck.gl/core@8.9.32/dist.min.js"></script>
     <script src="https://unpkg.com/@deck.gl/layers@8.9.32/dist.min.js"></script>
     <script src="https://unpkg.com/@deck.gl/aggregation-layers@8.9.32/dist.min.js"></script>
     <script src="https://unpkg.com/@deck.gl/mapbox@8.9.32/dist.min.js"></script>
     <script src="https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.js"></script>
     <link href="https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.css" rel="stylesheet"/>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
 
     <style>
         body { 
             margin: 0; 
             padding: 0; 
         }
         #map { 
             position: absolute; 
             top: 0; 
             bottom: 0; 
             width: 100%; 
         }
         .control-panel {
             position: absolute;
             top: 0;
             left: 0;
             width: 300px;
             background: white;
             margin: 20px;
             padding: 20px;
             border-radius: 8px;
             box-shadow: 0 2px 10px rgba(0,0,0,0.1);
             font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
             z-index: 1;
         }
         .control-panel h3 {
             color: #262730;
             font-size: 18px;
             margin: 0 0 20px 0;
             font-weight: 600;
         }
         .control-panel .layer-option {
             display: flex;
             align-items: center;
             margin-bottom: 15px;
         }
         .control-panel .layer-option label {
             display: flex;
             align-items: center;
             color: #262730;
             font-size: 14px;
             font-weight: 500;
             cursor: pointer;
         }
         .control-panel input[type="checkbox"] {
             margin-right: 10px;
             width: 16px;
             height: 16px;
             cursor: pointer;
         }
         .control-panel .slider-container {
             margin: 20px 0;
         }
         .control-panel .slider-label {
             display: block;
             color: #262730;
             font-size: 14px;
             font-weight: 500;
             margin-bottom: 8px;
         }
         .control-panel input[type="range"] {
             width: 100%;
             margin: 8px 0;
         }
         .control-panel .section-divider {
             border-top: 1px solid #f0f0f0;
             margin: 15px 0;
         }
         .control-panel .style-select {
             width: 100%;
             padding: 8px;
             margin-top: 5px;
             border: 1px solid #ddd;
             border-radius: 4px;
             background-color: white;
             font-size: 14px;
         }
         .control-panel .style-select:focus {
             outline: none;
             border-color: #4299e1;
         }
     </style>
 </head>
 <body>
     <div id="map"></div>
     <div class="control-panel">
         <h3>Layer Controls</h3>
         <div class="layer-option">
             <span class="slider-label">Map Style</span>
             <select id="map-style" class="style-select">
                 <option value="mapbox://styles/mapbox/dark-v10">Dark</option>
                 <option value="mapbox://styles/mapbox/light-v10">Light</option>
                 <option value="mapbox://styles/mapbox/satellite-v9">Satellite</option>
                 <option value="mapbox://styles/mapbox/streets-v11">Streets</option>
                 <option value="mapbox://styles/mapbox/outdoors-v11">Outdoors</option>
             </select>
         </div>
         <div class="section-divider"></div>
         <div class="layer-option">
             <label>
                 <input type="checkbox" id="scatter" checked>
                 Scatterplot
             </label>
         </div>
         <div class="layer-option">
             <label>
                 <input type="checkbox" id="heatmap">
                 Heatmap
             </label>
         </div>
         <div class="layer-option">
             <label>
                 <input type="checkbox" id="hexagon">
                 Hexagon
             </label>
         </div>
         <div class="layer-option">
             <label>
                 <input type="checkbox" id="buildings">
                 3D Buildings
             </label>
         </div>
         <div class="section-divider"></div>
         <div class="slider-container">
             <span class="slider-label">Point Size</span>
             <input type="range" id="point-radius" min="1" max="50" value="10">
         </div>
         <div class="slider-container">
             <span class="slider-label">Hexagon Radius</span>
             <input type="range" id="radius" min="10" max="200" value="50">
         </div>
         <div class="slider-container">
             <span class="slider-label">Hexagon Height Scale</span>
             <input type="range" id="elevation" min="1" max="20" value="5">
         </div>
     </div>
 
     <script type="text/javascript">
         const MAPBOX_TOKEN = 'pk.eyJ1IjoiamNkZW50b24yMDUxIiwiYSI6ImNtMzVkZXJudTA5ejkya3B5NDU4Z2MyeHQifQ.aUk4eH5k3JC45Foxcbe2qQ';
         let deckgl;
         let mapboxMap;
 
         function toggle3DBuildings(map, enabled) {
             const layerId = '3d-buildings';
             if (enabled) {
                 if (!map.getLayer(layerId)) {
                     map.addLayer({
                         'id': layerId,
                         'source': 'composite',
                         'source-layer': 'building',
                         'filter': ['has', 'height'],
                         'type': 'fill-extrusion',
                         'minzoom': 14,
                         'paint': {
                             'fill-extrusion-color': '#aaa',
                             'fill-extrusion-height': ['get', 'height'],
                             'fill-extrusion-base': ['get', 'min_height'],
                             'fill-extrusion-opacity': 0.6
                         }
                     });
                 }
             } else if (map.getLayer(layerId)) {
                 map.removeLayer(layerId);
             }
         }
 
         async function initializeMap() {
             try {
                 // Load CSV data
                 const response = await fetch('/assets/df.csv');
                 const csvText = await response.text();
                 const results = Papa.parse(csvText, {
                     header: true,
                     dynamicTyping: true
                 });
 
                 const data = results.data.filter(row => row.latitude && row.longitude);
 
                 // Calculate center point
                 const center = data.length > 0 ? 
                     data.reduce((acc, row) => ({
                         latitude: acc.latitude + row.latitude / data.length,
                         longitude: acc.longitude + row.longitude / data.length
                     }), { latitude: 0, longitude: 0 }) : 
                     { latitude: 24.467, longitude: 54.608 };
 
                 function getLayers() {
                     const layers = [];
                     const hexRadius = document.getElementById('radius').value;
                     const elevation = document.getElementById('elevation').value;
                     const pointRadius = document.getElementById('point-radius').value;
 
                     if (document.getElementById('scatter').checked) {
                         layers.push(new deck.ScatterplotLayer({
                             id: 'scatter',
                             data,
                             getPosition: d => [d.longitude, d.latitude],
                             getFillColor: [255, 0, 0, 140],
                             getRadius: parseInt(pointRadius),
                             pickable: true
                         }));
                     }
 
                     if (document.getElementById('heatmap').checked) {
                         layers.push(new deck.HeatmapLayer({
                             id: 'heat',
                             data,
                             getPosition: d => [d.longitude, d.latitude],
                             getWeight: 1,
                             radiusPixels: 60,
                             intensity: 1
                         }));
                     }
 
                     if (document.getElementById('hexagon').checked) {
    layers.push(new deck.HexagonLayer({
        id: 'hex',
        data,
        getPosition: d => [d.longitude, d.latitude],
        radius: parseInt(hexRadius),
        elevationScale: parseInt(elevation),
        extruded: true,
        colorRange: [
            [245, 240, 200],
            [230, 220, 160],
            [230, 179, 95],
            [227, 139, 79],
            [215, 95, 78],
            [200, 43, 66]
        ],
        coverage: 0.8,
        upperPercentile: 100,
        elevationRange: [0, 1000],
        getElevationValue: points => points.length,
        getColorValue: points => points.length,
        pickable: true,
        autoHighlight: true,
        material: {
            ambient: 0.64,
            diffuse: 0.6,
            shininess: 32,
            specularColor: [51, 51, 51]
        }
    }));
}
 
                     return layers;
                 }
 
                 // Initialize deck.gl
                 deckgl = new deck.DeckGL({
                     container: 'map',
                     mapboxApiAccessToken: MAPBOX_TOKEN,
                     mapStyle: 'mapbox://styles/mapbox/dark-v10',
                     initialViewState: {
                         longitude: center.longitude,
                         latitude: center.latitude,
                         zoom: 15,
                         pitch: 45,
                         bearing: 0
                     },
                     controller: true,
                     layers: getLayers(),
                     onWebGLInitialized: () => {
                         mapboxMap = deckgl.getMapboxMap();
                         
                         // Add buildings toggle listener
                         document.getElementById('buildings').addEventListener('change', (e) => {
                             toggle3DBuildings(mapboxMap, e.target.checked);
                         });
                     }
                 });
 
                 // Add event listeners for controls
                 document.querySelectorAll('input').forEach(input => {
                     if (input.id !== 'buildings') {  // Skip buildings checkbox as it's handled separately
                         input.addEventListener('change', () => {
                             deckgl.setProps({layers: getLayers()});
                         });
                     }
                 });
 
                 // Add event listener for map style changes
                 document.getElementById('map-style').addEventListener('change', (e) => {
                     const buildingsEnabled = document.getElementById('buildings').checked;
                     deckgl.setProps({
                         mapStyle: e.target.value
                     });
                     mapboxMap.once('style.load', () => {
                         if (buildingsEnabled) {
                             toggle3DBuildings(mapboxMap, true);
                         }
                         deckgl.setProps({layers: getLayers()});
                     });
                 });
 
             } catch (error) {
                 console.error('Error loading or processing data:', error);
             }
         }
 
         initializeMap();
     </script>
 </body>
 </html>


 -->




